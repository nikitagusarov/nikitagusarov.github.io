<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Self-hosting | Nikita Gusarov</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Today we are going to speak about the self-hosting. Since the start of January I&rsquo;ve spent some time on configuration of my home server for my personal applications. The idea behind this transition was to put some more distance between myself and my dependence on the external services, where I&rsquo;ve no means to control my personal data. The last year, I&rsquo;ve already performed the transition from using the Google Drive and Dropbox to the usage of more private NextCloud solutions (offered by my university,as well as a privacy respecting server in Zurich).">
    <meta name="generator" content="Hugo 0.87.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    
      

    

    
    
    <meta property="og:title" content="Self-hosting" />
<meta property="og:description" content="Today we are going to speak about the self-hosting. Since the start of January I&rsquo;ve spent some time on configuration of my home server for my personal applications. The idea behind this transition was to put some more distance between myself and my dependence on the external services, where I&rsquo;ve no means to control my personal data. The last year, I&rsquo;ve already performed the transition from using the Google Drive and Dropbox to the usage of more private NextCloud solutions (offered by my university,as well as a privacy respecting server in Zurich)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nikitagusarov.github.io/post/2022-02-01-self-hosting/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-01T00:00:00+00:00" /><meta property="og:site_name" content="Nikita Gusarov" />

<meta itemprop="name" content="Self-hosting">
<meta itemprop="description" content="Today we are going to speak about the self-hosting. Since the start of January I&rsquo;ve spent some time on configuration of my home server for my personal applications. The idea behind this transition was to put some more distance between myself and my dependence on the external services, where I&rsquo;ve no means to control my personal data. The last year, I&rsquo;ve already performed the transition from using the Google Drive and Dropbox to the usage of more private NextCloud solutions (offered by my university,as well as a privacy respecting server in Zurich)."><meta itemprop="datePublished" content="2022-02-01T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-02-01T00:00:00+00:00" />
<meta itemprop="wordCount" content="1451">
<meta itemprop="keywords" content="Programming,Self-hosting,Linux,Home Server," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Self-hosting"/>
<meta name="twitter:description" content="Today we are going to speak about the self-hosting. Since the start of January I&rsquo;ve spent some time on configuration of my home server for my personal applications. The idea behind this transition was to put some more distance between myself and my dependence on the external services, where I&rsquo;ve no means to control my personal data. The last year, I&rsquo;ve already performed the transition from using the Google Drive and Dropbox to the usage of more private NextCloud solutions (offered by my university,as well as a privacy respecting server in Zurich)."/>

	
  </head>

  <body class="ma0 courrier bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://nikitagusarov.github.io/images/self-hosting-0.png');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Nikita Gusarov
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/background/" title="Background page">
              Background
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Posts page">
              Posts
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/publications/" title="Publications page">
              Publications
            </a>
          </li>
          
        </ul>
      
      







<a href="https://fr.linkedin.com/in/nikita-gusarov-264a25175" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/nikitagusarov" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://gitlab.com/nikitagusarov" target="_blank" class="link-transition gitlab link dib z-999 pt3 pt0-l mr1" title="Gitlab link" rel="noopener" aria-label="follow on Gitlab——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="M29.782 199.732L256 493.714 8.074 309.699c-6.856-5.142-9.712-13.996-7.141-21.993l28.849-87.974zm75.405-174.806c-3.142-8.854-15.709-8.854-18.851 0L29.782 199.732h131.961L105.187 24.926zm56.556 174.806L256 493.714l94.257-293.982H161.743zm349.324 87.974l-28.849-87.974L256 493.714l247.926-184.015c6.855-5.142 9.711-13.996 7.141-21.993zm-85.404-262.78c-3.142-8.854-15.709-8.854-18.851 0l-56.555 174.806h131.961L425.663 24.926z"></path></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>







    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Self-hosting</h1>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://nikitagusarov.github.io/post/2022-02-01-self-hosting/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://nikitagusarov.github.io/post/2022-02-01-self-hosting/&amp;text=Self-hosting" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nikitagusarov.github.io/post/2022-02-01-self-hosting/&amp;title=Self-hosting" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Self-hosting</h1>
      
      <p class="tracked">
          By <strong>
          
              Nikita Gusarov
          
          </strong>
      </p>
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-02-01T00:00:00Z">February 1, 2022</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy courrier bg-near-white f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Today we are going to speak about the <em>self-hosting</em>.
Since the start of January I&rsquo;ve spent some time on configuration of my home server for my personal applications.
The idea behind this transition was to put some more distance between myself and my dependence on the external services, where I&rsquo;ve no means to control my personal data.
The last year, I&rsquo;ve already performed the transition from using the <em>Google Drive</em> and <em>Dropbox</em> to the usage of more private <em>NextCloud</em> solutions (offered by my university,as well as a privacy respecting server in Zurich).
Nevertheless, when I&rsquo;ve discovered a long unused motherboard, belonging to my school laptop, I&rsquo;ve decided to give it a new life.</p>
<p>What is more, this period coincided with my discovery of <em>Vaultwarden</em>, a free <em>Bitwarden</em> fork, which perfectly matched with my idea of my security policy renewal.
In short, all considerations combined I&rsquo;ve decided to start self-hosting some of cloud services for personal (and family) use.</p>
<h2 id="why-self-host-anything">Why self-host anything?</h2>
<p>Among the main advantages of self-hosting in my personal use-case I may name:</p>
<ul>
<li>Breaching the dependency on third party solutions</li>
<li>Gaining full control over personal data, its storage and security</li>
<li>A chance to organise your own FOSS oriented ecosystem</li>
<li>Possibility to tinker with some new tech</li>
</ul>
<p>All of this sounds quite awesome, but everything goes at a price.
Among the drawbacks one can easily name:</p>
<ul>
<li>Potential security risks linked with a lack of proficiency and tech knowledge of the user</li>
<li>Potential lower reliability in cases of electricity outages and unforeseen events</li>
</ul>
<p>At this point it&rsquo;s important to weight the risks and your ability to take them.
In last years I had nearly no reliability on the external services and a sudden loss of my server or its data is not that frightening perspective for me.
Moreover, with a quite simple configuration of <code>cron</code> jobs it&rsquo;s possible to organise systematic backups.
That, with occasional manual backups on external hard drives makes data / server loss not that a tragedy.</p>
<h2 id="what-applications-to-host">What applications to host?</h2>
<p>Because of the experimental nature of the setup, I&rsquo;ve decided to stick with some most popular and subjectively useful software choices.
Here they are:</p>
<ul>
<li><em>Vaultwarden</em> - a free fork of <em>Bitwarden</em> for secure password management and synchronisation across multiple devices</li>
<li><em>Nextcloud</em> - an open source cloud storage solution</li>
</ul>
<p>Both of them are quite popular choices and there are plenty of guides on how to install and configure them.
Nevertheless, I&rsquo;ve encountered some difficulties with first time <em>reverse proxy</em> configuration, but I&rsquo;ll speak later about it.</p>
<h2 id="server-configuration">Server configuration</h2>
<p>For the server I&rsquo;ve used a motherboard of my old HP (15-bs007) laptop, placed into a custom built enclosure.
It has quite a weak, 2 core processor (Celeron N3060), but it&rsquo;s more than enough for a small home server for personal use.
Such a weak configuration provides one advantage: low power usage, which is extremely good for server running 24/7.
And 4Gb of RAM suffices for the intended use case as well.</p>
<p><img src="/images/self-hosting-1.png" alt="Server configuration"></p>
<p>The OS choice has been made in favour of <em>Ubntu Server</em>, with the LTS version.
The installation of the system is rather straightforward and I will not include the details of this step here.
It is simply required to follow the CLI installer to fully configure the server.
Among the additional steps we have:</p>
<ul>
<li>Generation of several non-sudo users for confusion purposes</li>
<li>Renaming of the single sudoer to something unexpected</li>
<li>Configuration of password-less login via <code>ssh</code> (with <code>ssh</code> keys), with password login being fully blocked</li>
<li>Transition of the <code>ssh</code> connection port to something other than default port 22</li>
<li>Enabling <code>ufw</code> and closing all other ports except one used for <code>ssh</code> session</li>
</ul>
<blockquote>
<p>After this steps it will be nice to verify whether everything works by logging in via ssh on local network</p>
</blockquote>
<h2 id="applications-installation">Applications installation</h2>
<p>Now we may proceed with the installation of required packages.
We will use <code>nginx</code> as our reverse proxy, <code>docker</code> for our <em>Vaultwarden</em> instance and <code>snap</code> version of <em>NextCloud</em> as it&rsquo;s suggested on official website.
Because all the applications rely on the reverse proxy and should be configured accordingly we start with proxy configuration.</p>
<h3 id="reverse-proxy">Reverse proxy</h3>
<p>The advantage of the reverse proxy is the possibility to serve several applications from a single IP by using subdirectories or subdomains.
The connection from client to server should be configured to be encrypted (<em>https</em>), while within server (from proxy to the application) simple <em>http</em> requests are made.</p>
<p>We start with simple installation and activation:</p>
<pre><code>sudo apt-get install nginx
sudo systemctl enable nginx
</code></pre><p>Once the <code>nginx</code> installed, we need to configure the rules for it in our firewall, granting it the access to other ports, on which the applications will run.</p>
<pre><code>sudo ufw allow &quot;Nginx Full&quot;
</code></pre><p>Here it&rsquo;s assumed that you already have some registered domain name(s), which will be used with this server.
In the case when applications are associated with subfolder we will only need one domain name (ex: some ISP provide an option to create one, at least in France).
Before certifying our domain for secure connections we should create some simple web accessible page on our server and open it ot the world.
First, create a simple webpage:</p>
<pre><code>sudo vim /etc/nginx/sites-available/web
</code></pre><p>The file contents should look something like:</p>
<pre><code>server {
    listen 80;
    listen [::]:80;
    
    server_name &lt;yourdomain&gt;;
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name &lt;yourdomain&gt;;
}
</code></pre><p>We specify the behaviour for the connections on default ports (accessed by most web browsers by default).
Enable the created server block:</p>
<pre><code>sudo ln -s /etc/nginx/sites-available/web /etc/nginx/sites-enabled/
</code></pre><p>You may now test the configuration:</p>
<pre><code>sudo nginx -t
</code></pre><p>And finally restart the proxy:</p>
<pre><code>sudo systemctl restart nginx
</code></pre><p>Now we need to generate a certificate for the chosen domain.
One of the simplest solutions without additional costs is the option offered by <em>Let&rsquo;s Encrypt</em>.
<em>Let&rsquo;s Encrypt</em> provides even an automated configuration solution (<em>Certbot</em>: <code>python-certbot-nginx</code>) for the certificate management.
The certificate is generated with:</p>
<pre><code>sudo certbot --nginx -d &lt;yourdomain&gt;
</code></pre><p><em>Certbot</em> should automatically edit the contents of <code>/etc/nginx/sites-available/web</code> file.
From now on, the certificates may be automatically renewed with the command <code>sudo certbot renew</code> as a <code>cron</code> job.
We may want to configure <code>nginx</code> with <code>certbot</code> to connect always in https mode, redirecting eventual http connections.</p>
<h3 id="nextcloud">NextCloud</h3>
<p><img src="/images/self-hosting-2.png" alt="NextCloud"></p>
<p><em>NextCloud</em> is identically simple to install:</p>
<pre><code>sudo snap install nextcloud
</code></pre><p>It&rsquo;s important to create an admin account before proceeding:</p>
<pre><code>sudo nextcloud.manual-install &lt;user&gt; &lt;passwd&gt;
</code></pre><p>Next the ports should be configured:</p>
<pre><code>sudo snap set nextcloud ports.http=&lt;nexcloudhttpport&gt;
sudo snap set nextcloud ports.https=&lt;nextcloudhttpsport&gt;
</code></pre><p>Finally add the <em>NextCloud</em> related configuration lines to the server block (the part listening to the port 443) in <code>nginx</code> configuration.
For example, we may use:</p>
<pre><code># CalDav configuration for NextCloud
location /.well-known {
        # The rules in this block are an adaptation of the rules
        # in the Nextcloud `.htaccess` that concern `/.well-known`.
        location /.well-known/carddav { return 301 /nextcloud/remote.php/dav; }
        location /.well-known/caldav  { return 301 /nextcloud/remote.php/dav; }
        location /.well-known/webdav  { return 301 /nextcloud/remote.php/dav; }

        # Let Nextcloud's API for `/.well-known` URIs handle all other
        # requests by passing them to the front-end controller.
        return 301 /nextcloud/index.php$request_uri;
}

# Main NextCloud configuration
# we us &lt;yourdomain&gt;/nextcloud as root directory for application
location /nextcloud {
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        add_header Front-End-Https on;
        proxy_headers_hash_max_size 512;
        proxy_headers_hash_bucket_size 64;
        fastcgi_hide_header X-Powered-By;
        proxy_buffering off;
        proxy_redirect off;
        proxy_max_temp_file_size 0;
        
        rewrite ^/nextcloud(.*)$ $1 break;
        sub_filter &quot;/core/&quot; &quot;/nextcloud/core/&quot;;
        sub_filter_once off;
        proxy_pass http://127.0.0.1:&lt;nexcloudhttpport&gt;;

        if ( $http_user_agent ~ ^DavClnt ) {
                return 302 /nextcloud/remote.php/webdav/$is_args$args;
        }
}
</code></pre><h3 id="vaultwarden">Vaultwarden</h3>
<p><img src="/images/self-hosting-3.png" alt="Vaultwarden"></p>
<p>Finally, we install <em>Vaultwarden</em> as docker container on our system.
First we will need a working docker installation.
I&rsquo;ll not describe the complete procedure here, because it&rsquo;s subject to be modified with time.
It&rsquo;s better to refer directly to the <a href="https://docs.docker.com/engine/install/">Docker website</a> for more precise and up to date instructions.
To start docker container with <em>Vaultwarden</em> run:</p>
<pre><code>docker run -d --name vaultwarden \
    -v /vw-data/:/data/ \
    -p &lt;vwport&gt;:80 \ 
    vaultwarden/server:latest \
    --restart=unless-stopped \
    -e DOMAIN=&lt;yourdomain&gt;/vw
</code></pre><p>This command will pull the latest <em>Vaultwarden</em> image and deploy it.
We assume that one may be interested to configure the U2F authentication for this application, which requires a <code>DOMAIN</code> environmental variable to be provided.
Next, the contents we add to our proxy configurations are as follows:</p>
<pre><code># Vaultwarden configuration
location /vaultwarden/ {
    proxy_headers_hash_max_size 512;
    proxy_headers_hash_bucket_size 64;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    add_header Front-End-Https on;

    rewrite ^/vaultwarden(.*) /$1 break;
    proxy_pass http://127.0.0.1:&lt;vwport&gt;;
}
</code></pre><p>Please note, that these contents are placed inside the same <code>server</code> block of our proxy configuration as previously added entry related to <em>NextCloud</em>.
This will allow us to reach <em>Vaultwarden</em> from behind the <code>nginx</code> proxy.</p>
<p>Finally it remains to schedule the automated jobs for updates and backups.
As well as harden the configuration with additional security measures (ex: <code>fail2ban</code>), but we will talk about it another time.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/programming" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Programming</a>
   </li>
  
   <li class="list">
     <a href="/tags/self-hosting" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Self-hosting</a>
   </li>
  
   <li class="list">
     <a href="/tags/linux" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Linux</a>
   </li>
  
   <li class="list">
     <a href="/tags/home-server" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Home Server</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/2022-01-29-onlykey-for-linux/">OnlyKey for Linux login</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2021-12-27-rstudio-or-vs-code/">RStudio or VS Code</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nikitagusarov.github.io/" >
    &copy;  Nikita Gusarov 2022 
  </a>
    <div>







<a href="https://fr.linkedin.com/in/nikita-gusarov-264a25175" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/nikitagusarov" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://gitlab.com/nikitagusarov" target="_blank" class="link-transition gitlab link dib z-999 pt3 pt0-l mr1" title="Gitlab link" rel="noopener" aria-label="follow on Gitlab——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="M29.782 199.732L256 493.714 8.074 309.699c-6.856-5.142-9.712-13.996-7.141-21.993l28.849-87.974zm75.405-174.806c-3.142-8.854-15.709-8.854-18.851 0L29.782 199.732h131.961L105.187 24.926zm56.556 174.806L256 493.714l94.257-293.982H161.743zm349.324 87.974l-28.849-87.974L256 493.714l247.926-184.015c6.855-5.142 9.711-13.996 7.141-21.993zm-85.404-262.78c-3.142-8.854-15.709-8.854-18.851 0l-56.555 174.806h131.961L425.663 24.926z"></path></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>






</div>
  </div>
</footer>

  </body>
</html>
