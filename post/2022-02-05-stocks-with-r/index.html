<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Financial market analysis with R | Nikita Gusarov</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Recently I’ve became obsessed with the idea of getting into stock exchange (for testing purposes and not for actual investment). One of the main reasons is the desire to start putting something aside for long-term perspective, but in short perspective this project gives me quite a lot of things to play with. Among them - the possibility to explore the predictive financial oriented models, neural networks (NN) testing for stock predictions and many more.">
    <meta name="generator" content="Hugo 0.87.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    
      

    

    
    
    <meta property="og:title" content="Financial market analysis with R" />
<meta property="og:description" content="Recently I’ve became obsessed with the idea of getting into stock exchange (for testing purposes and not for actual investment). One of the main reasons is the desire to start putting something aside for long-term perspective, but in short perspective this project gives me quite a lot of things to play with. Among them - the possibility to explore the predictive financial oriented models, neural networks (NN) testing for stock predictions and many more." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nikitagusarov.github.io/post/2022-02-05-stocks-with-r/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-05T00:00:00+00:00" /><meta property="og:site_name" content="Nikita Gusarov" />

<meta itemprop="name" content="Financial market analysis with R">
<meta itemprop="description" content="Recently I’ve became obsessed with the idea of getting into stock exchange (for testing purposes and not for actual investment). One of the main reasons is the desire to start putting something aside for long-term perspective, but in short perspective this project gives me quite a lot of things to play with. Among them - the possibility to explore the predictive financial oriented models, neural networks (NN) testing for stock predictions and many more."><meta itemprop="datePublished" content="2022-02-05T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-02-05T00:00:00+00:00" />
<meta itemprop="wordCount" content="1677">
<meta itemprop="keywords" content="Programming,R,Finance,Time Series," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Financial market analysis with R"/>
<meta name="twitter:description" content="Recently I’ve became obsessed with the idea of getting into stock exchange (for testing purposes and not for actual investment). One of the main reasons is the desire to start putting something aside for long-term perspective, but in short perspective this project gives me quite a lot of things to play with. Among them - the possibility to explore the predictive financial oriented models, neural networks (NN) testing for stock predictions and many more."/>

	<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
});
</script>

<script async type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </head>

  <body class="ma0 courrier bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://nikitagusarov.github.io/images/stocks-0.png');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Nikita Gusarov
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/background" title="Background page">
              Background
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/development" title="Development page">
              Development
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/publications" title="Publications page">
              Publications
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/talks" title="Talks page">
              Talks
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="" title="Activities page">
              Activities
            </a>
          </li>
          
        </ul>
      
      







<a href="https://linkedin.com/in/nikitagusarov" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/nikitagusarov" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://gitlab.com/nikitagusarov" target="_blank" class="link-transition gitlab link dib z-999 pt3 pt0-l mr1" title="Gitlab link" rel="noopener" aria-label="follow on Gitlab——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="M29.782 199.732L256 493.714 8.074 309.699c-6.856-5.142-9.712-13.996-7.141-21.993l28.849-87.974zm75.405-174.806c-3.142-8.854-15.709-8.854-18.851 0L29.782 199.732h131.961L105.187 24.926zm56.556 174.806L256 493.714l94.257-293.982H161.743zm349.324 87.974l-28.849-87.974L256 493.714l247.926-184.015c6.855-5.142 9.711-13.996 7.141-21.993zm-85.404-262.78c-3.142-8.854-15.709-8.854-18.851 0l-56.555 174.806h131.961L425.663 24.926z"></path></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>







    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Financial market analysis with R</h1>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://nikitagusarov.github.io/post/2022-02-05-stocks-with-r/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://nikitagusarov.github.io/post/2022-02-05-stocks-with-r/&amp;text=Financial%20market%20analysis%20with%20R" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nikitagusarov.github.io/post/2022-02-05-stocks-with-r/&amp;title=Financial%20market%20analysis%20with%20R" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Financial market analysis with R</h1>
      
      <p class="tracked">
          By <strong>
          
              Nikita Gusarov
          
          </strong>
      </p>
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-02-05T00:00:00Z">February 5, 2022</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy courrier bg-near-white f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">
<script src="https://nikitagusarov.github.io/post/2022-02-05-stocks-with-r/index_files/header-attrs/header-attrs.js"></script>


<p>Recently I’ve became obsessed with the idea of getting into stock exchange (for <em>testing purposes</em> and not for actual <em>investment</em>).
One of the main reasons is the desire to start putting something aside for long-term perspective, but in short perspective this project gives me quite a lot of things to play with.
Among them - the possibility to explore the predictive financial oriented models, neural networks (NN) testing for stock predictions and many more.</p>
<p>Obviously, before switching to data analysis and investing one should acquire data for analysis.
Here our well known <em>R</em> language ecosystem can give us a hand: there exist quite a number of packages and API interfaces for stock data retrieval.
In this post we are going to focus on one of the simplest solutions - the <a href="https://data.nasdaq.com/">Nasdaq data</a> platform.</p>
<div id="r-interfaces-for-financial-data-extraction" class="section level2">
<h2>R interfaces for financial data extraction</h2>
<p>Among the most popular interfaces, allowing to query various API’s for stocks information we find:</p>
<ul>
<li><a href="https://github.com/joshuaulrich/quantmod"><code>quantmod</code></a>, that provides a framework for quantitative financial modelling and trading (see <a href="https://www.quantmod.com/">here</a> for project’s official website)</li>
<li><a href="https://github.com/quandl/quandl-r"><code>Quandl</code></a>, which brings the possibility to interact with <a href="https://docs.data.nasdaq.com/">Quandl API</a></li>
</ul>
<p>The <code>quandmod</code> provides more features and data extraction back-ends.
It functions extremely well with a custom, modified version of the <code>zoo</code> times series format (bundled in <code>xts</code> package).
On their official website authors state, that <code>quandmod</code> is`:</p>
<blockquote>
<p>A rapid prototyping environment, where <code>quant</code> traders can quickly and cleanly explore and build trading models.</p>
</blockquote>
<p>In other words, this is a full featured package offering a dedicated environment for financial analysis needs.
However, I’ve found the dataset import features rather broken at the moment on the official CRAN version of the package.
It does not work well enough from behind a proxy or a custom DNS server.
The resolution of the “<em>yahoo</em>” domains fails, while “<em>google</em>” version is completely non-existent (because Google stopped to provide stocks information on a dedicated channel).</p>
<p>The <code>Quandl</code> has absolutely different ideology.
It provides uniquely the possibility to query the <em>Quandt API</em>, which extremely facilitates the dataset construction.
Consequently, for simple data import it may be better to stick with the <code>Quandl</code> solution.</p>
<p>Finally, there exists as well the <a href="https://github.com/business-science/tidyquant"><code>tidyquant</code></a>, bringing the <code>tidyverse</code> compatibility for both <code>quantmod</code> and <code>Quandl</code> packages. <code>This may be extremely useful if you are already familiar with the</code>tidyverse` ideology.</p>
</div>
<div id="starting-with-quandl" class="section level2">
<h2>Starting with <code>Quandl</code></h2>
<p>Evidently, before proceeding we should load the <code>Quandl</code> library:</p>
<pre class="r"><code># Load library
library(Quandl)
library(magrittr)</code></pre>
<p>To make out the most out of the integration with the <em>Quandt API</em> it’s advised to create a <strong>free</strong> account, which will provide you with an API key.
This API key gives unlimited access to <em>Quandt</em> databases, while the queries without API key are restricted to only 50 per day.</p>
<div class="figure">
<img src="/images/quandl-reg.png" alt="" />
<p class="caption">Quandt registration page</p>
</div>
<pre class="r"><code># Register key within R
api_key = &quot;SoMeTesTKeY123987456&quot;

# Pass the key to Quandl
Quandl.api_key(api_key)</code></pre>
<!-- 
In this post an API key from a testing profile is used, by the time the contents are published the profile does not exists anymore (so no point in attempting to connect with it to the server). 
-->
<p>From this point onwards, the interactions with <em>Quandt API</em> are rather straightforward.
The function <code>Quandl()</code> is a wrapper for the common API queries and is mostly sufficient for all the desired features.
For example, to get <strong>OIL</strong> history from <strong>NSE</strong> database it suffices to run:</p>
<pre class="r"><code># Extract data
oil = Quandl(&quot;NSE/OIL&quot;, type = &quot;zoo&quot;)</code></pre>
<p>What produces us a <code>zoo</code> time series data frame:</p>
<pre class="r"><code># Present results
oil[, 1:3] %&gt;% 
    as.data.frame() %&gt;%
    head() %&gt;%
    knitr::kable(&quot;html&quot;)</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Open
</th>
<th style="text-align:right;">
High
</th>
<th style="text-align:right;">
Low
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2009-09-30
</td>
<td style="text-align:right;">
1096.0
</td>
<td style="text-align:right;">
1156.7
</td>
<td style="text-align:right;">
1090.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009-10-01
</td>
<td style="text-align:right;">
1102.0
</td>
<td style="text-align:right;">
1173.7
</td>
<td style="text-align:right;">
1102.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009-10-05
</td>
<td style="text-align:right;">
1152.0
</td>
<td style="text-align:right;">
1165.9
</td>
<td style="text-align:right;">
1136.6
</td>
</tr>
<tr>
<td style="text-align:left;">
2009-10-06
</td>
<td style="text-align:right;">
1149.8
</td>
<td style="text-align:right;">
1157.2
</td>
<td style="text-align:right;">
1132.1
</td>
</tr>
<tr>
<td style="text-align:left;">
2009-10-07
</td>
<td style="text-align:right;">
1153.8
</td>
<td style="text-align:right;">
1160.7
</td>
<td style="text-align:right;">
1140.0
</td>
</tr>
<tr>
<td style="text-align:left;">
2009-10-08
</td>
<td style="text-align:right;">
1145.0
</td>
<td style="text-align:right;">
1179.8
</td>
<td style="text-align:right;">
1142.0
</td>
</tr>
</tbody>
</table>
<p>The command will actually perform the following query:</p>
<pre><code>GET https://data.nasdaq.com/api/v3/datasets/{database_code}/{dataset_code}/data.{return_format}</code></pre>
<p>Where <code>database_code = "NSE"</code> and <code>dataset_code = "OIL"</code>, returning the results in <code>zoo</code> format.
It’s equally possible to provide the API key information in order to get unlimited queries.
The other output formats are <code>ts</code>, <code>raw</code> (which returns <code>data.frame</code>), <code>xts</code> and <code>timeSeries</code>.</p>
<p>It’s possible to run more complex queries as well.
For more information one may want to read the <a href="https://docs.data.nasdaq.com/docs/in-depth-usage">Quandt API documentation</a>.
Once you become familiar with the queries, it becomes quite easy to perform all the necessary actions even without the <code>Quandl</code> wrapper.
For example, to load the above dataset in plain <code>.csv</code> format it without any auxiliary functions one can run:</p>
<pre class="r"><code># Parameters
database_code = &quot;NSE&quot;; dataset_code = &quot;OIL&quot;
format = &quot;csv&quot;</code></pre>
<pre class="r"><code># Querry
download.file(
    paste0(
        &quot;https://data.nasdaq.com/api/v3/datasets/&quot;,
        database_code, &quot;/&quot;, dataset_code, 
        &quot;/data.&quot;, format,
        &quot;?api_key=&quot;, api_key
    ),
    destfile = &quot;test.csv&quot;,
    method = &quot;wget&quot;
)</code></pre>
<p>Then the can read the resulting file as we would have done with simple <code>.csv</code>.
Or we may load read such <code>.csv</code> even without saving it into separate file:</p>
<pre class="r"><code># Querry
oil_csv = 
    paste0(
        &quot;https://data.nasdaq.com/api/v3/datasets/&quot;,
        database_code, &quot;/&quot;, dataset_code, 
        &quot;/data.&quot;, format,
        &quot;?api_key=&quot;, api_key
    ) %&gt;%
    read.csv() </code></pre>
<p>The resulting <code>data.frame</code> object is:</p>
<pre class="r"><code># Present results
oil_csv[, 1:4] %&gt;% 
    head() %&gt;%
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Date</th>
<th align="right">Open</th>
<th align="right">High</th>
<th align="right">Low</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-01-04</td>
<td align="right">172.05</td>
<td align="right">174.95</td>
<td align="right">172.05</td>
</tr>
<tr class="even">
<td align="left">2019-01-03</td>
<td align="right">172.80</td>
<td align="right">175.70</td>
<td align="right">171.50</td>
</tr>
<tr class="odd">
<td align="left">2019-01-02</td>
<td align="right">175.80</td>
<td align="right">176.20</td>
<td align="right">171.00</td>
</tr>
<tr class="even">
<td align="left">2019-01-01</td>
<td align="right">175.00</td>
<td align="right">176.40</td>
<td align="right">174.15</td>
</tr>
<tr class="odd">
<td align="left">2018-12-31</td>
<td align="right">178.10</td>
<td align="right">179.00</td>
<td align="right">174.35</td>
</tr>
<tr class="even">
<td align="left">2018-12-28</td>
<td align="right">172.45</td>
<td align="right">178.45</td>
<td align="right">171.30</td>
</tr>
</tbody>
</table>
<p>However, there is little sense in reinventing the wheel, when we already have <code>Quandl</code> at our disposal.
The more advanced features made available through complex API calls turn to be extremely simple with through <code>Quandl</code> interface.
For example, a complex query which should retrieve <em>monthly % changes in Facebook’s closing price for the year 2016</em>:</p>
<pre><code>curl &quot;https://data.nasdaq.com/api/v3/datasets/WIKI/FB.csv?column_index=4&amp;start_date=2014-01-01&amp;end_date=2014-12-31&amp;collapse=monthly&amp;transform=rdiff&amp;api_key=YOURAPIKEY</code></pre>
<p>May be rewritten using <code>Quandl</code> as simple as:</p>
<pre class="r"><code># Querry
fb_mdp_2016 = Quandl(
    &quot;WIKI/FB&quot;, 
    start_date = &quot;2016-01-01&quot;, 
    end_date = &quot;2016-12-31&quot;,
    collapse = &quot;monthly&quot;,
    transform = &quot;rdiff&quot;,
    column_index = 11
)

# Results presentation
fb_mdp_2016 %&gt;% 
    as.data.frame() %&gt;% 
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Date</th>
<th align="right">Adj. Close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-12-31</td>
<td align="right">-0.0284580</td>
</tr>
<tr class="even">
<td align="left">2016-11-30</td>
<td align="right">-0.0959615</td>
</tr>
<tr class="odd">
<td align="left">2016-10-31</td>
<td align="right">0.0212053</td>
</tr>
<tr class="even">
<td align="left">2016-09-30</td>
<td align="right">0.0170473</td>
</tr>
<tr class="odd">
<td align="left">2016-08-31</td>
<td align="right">0.0175892</td>
</tr>
<tr class="even">
<td align="left">2016-07-31</td>
<td align="right">0.0845292</td>
</tr>
<tr class="odd">
<td align="left">2016-06-30</td>
<td align="right">-0.0381281</td>
</tr>
<tr class="even">
<td align="left">2016-05-31</td>
<td align="right">0.0104610</td>
</tr>
<tr class="odd">
<td align="left">2016-04-30</td>
<td align="right">0.0304996</td>
</tr>
<tr class="even">
<td align="left">2016-03-31</td>
<td align="right">0.0671530</td>
</tr>
<tr class="odd">
<td align="left">2016-02-29</td>
<td align="right">-0.0471437</td>
</tr>
</tbody>
</table>
<p>The ease of use may be extended even further.
Even though <code>Quandl()</code> can operate over vectors, the resulting <code>data.frame</code> inherits inefficient column names representing a sequence of <code>{database_code}/{dataset_code} {value_name}</code>.
As you can see, this format requires some additional transformation steps after to become <code>tidy</code>.
We can equally use the <code>tidyquant</code> for the same purpose, which output directly a <code>tidy</code> data-frame and can take even <code>data.frame</code>s as inputs.</p>
<pre class="r"><code># Load tidyquant
library(tidyquant)

# Stocks
stocks = c(&quot;WIKI/FB&quot;, &quot;WIKI/AAPL&quot;)

# Querry
db = stocks %&gt;%
    tq_get(
        get = &quot;quandl&quot;,
        start_date = &quot;2016-01-01&quot;, 
        end_date = &quot;2016-12-31&quot;,
        collapse = &quot;quarterly&quot;,
        transform = &quot;rdiff&quot;,
        column_index = 11
    )

# Results presentation
knitr::kable(db)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">symbol</th>
<th align="left">date</th>
<th align="right">adj.close</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">WIKI/FB</td>
<td align="left">2016-06-30</td>
<td align="right">0.0015776</td>
</tr>
<tr class="even">
<td align="left">WIKI/FB</td>
<td align="left">2016-09-30</td>
<td align="right">0.1224186</td>
</tr>
<tr class="odd">
<td align="left">WIKI/FB</td>
<td align="left">2016-12-31</td>
<td align="right">-0.1030638</td>
</tr>
<tr class="even">
<td align="left">WIKI/AAPL</td>
<td align="left">2016-06-30</td>
<td align="right">-0.1174931</td>
</tr>
<tr class="odd">
<td align="left">WIKI/AAPL</td>
<td align="left">2016-09-30</td>
<td align="right">0.1888981</td>
</tr>
<tr class="even">
<td align="left">WIKI/AAPL</td>
<td align="left">2016-12-31</td>
<td align="right">0.0298194</td>
</tr>
</tbody>
</table>
<p>Such data can be easily filtered, transformed and explored afterwards.</p>
</div>
<div id="searching-for-data" class="section level2">
<h2>Searching for data</h2>
<p>The <code>Quandl</code> package offers some particularly interesting functionality for querying the databases index.
It may be used through a <code>Quandl.search()</code> command or, better, through <code>tidyquant</code>’s <code>quandl_search()</code> wrapper.
For example, we can search for <em>Apple</em>:</p>
<pre class="r"><code># Search for Apple
&quot;Apple&quot; %&gt;% 
    quandl_search(
        per_page = 5, 
        silent = TRUE
    ) %&gt;% 
    dplyr::select(
        c(dataset_code, database_code, name)
    ) %&gt;%
    knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">dataset_code</th>
<th align="left">database_code</th>
<th align="left">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">APPL</td>
<td align="left">OTCB</td>
<td align="left">Appell Petroleum Corp (APPL) Adjusted Stock Prices</td>
</tr>
<tr class="even">
<td align="left">0482_HYINCOME</td>
<td align="left">RB1</td>
<td align="left">Apple — HYIncome</td>
</tr>
<tr class="odd">
<td align="left">0482_VALUES</td>
<td align="left">RB1</td>
<td align="left">Apple — Values</td>
</tr>
<tr class="even">
<td align="left">0482_HYBALANCE</td>
<td align="left">RB1</td>
<td align="left">Apple — HYBalance</td>
</tr>
<tr class="odd">
<td align="left">0482_FORECAST</td>
<td align="left">RB1</td>
<td align="left">Apple — Forecast</td>
</tr>
</tbody>
</table>
<p>Unfortunately, the default <code>Quandl</code> databases do not contain information about any of the ETF’s.
The only easily accessible indexes are:</p>
<pre class="r"><code># Indexes
tq_index_options()</code></pre>
<pre><code>## [1] &quot;DOW&quot;       &quot;DOWGLOBAL&quot; &quot;SP400&quot;     &quot;SP500&quot;     &quot;SP600&quot;</code></pre>
<p>The number of stock exchanges is equally limited and may not be suitable for some users (especially if we speak about EU):</p>
<pre class="r"><code># Exchanges
tq_exchange_options()</code></pre>
<pre><code>## [1] &quot;AMEX&quot;   &quot;NASDAQ&quot; &quot;NYSE&quot;</code></pre>
<p>As you can see, the toolset offers access to USA based exchanges, but no other <strong>free</strong> options are offered.</p>
<p>The <code>tq_get()</code> function unites the capabilities of both <code>Quandl</code> and <code>quandmod</code> packages.
However, the documentation is outdated and some sources are unavailable.
Among the listed on the <a href="https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ01-core-functions-in-tidyquant.html">package’s vignettes</a> we find:</p>
<ul>
<li><a href="https://finance.yahoo.com/">Yahoo Finance</a> - Daily stock data</li>
<li><a href="https://fred.stlouisfed.org/">FRED</a> - Economic data (<em>US specific mostly</em>)</li>
<li><a href="https://data.nasdaq.com/">Quandl</a> - Economic, Energy, &amp; Financial Data API</li>
<li><a href="https://www.tiingo.com/">Tiingo</a> - Financial API with sub-daily stock data and crypto-currency</li>
<li><a href="https://www.alphavantage.co/">Alpha Vantage</a> - Financial API with sub-daily, ForEx, and crypto-currency data</li>
<li><a href="https://www.bloomberg.com/">Bloomberg</a> - Financial API (<em>paid account is required</em>)</li>
</ul>
<p>Unfortunately, some of the API’s do not perform as intended.
One example is the Yahoo Finance, which seems to be extremely difficult to reach from behind a custom DNS with filtered <em>adblocking</em>.
However, lowering your defences will allow you to get your hands on some of the ETF’s data (at least the selection available on <em>Yahoo</em>).</p>
</div>
<div id="closing-remarks" class="section level2">
<h2>Closing remarks</h2>
<p>One of the main disadvantages of both <code>quandmod</code> and <code>Quandl</code> (as well as the <code>tidyquant</code>) is the low availability of data.
Most of the historic datasets, interesting for EU residents, are simply unavailable for <strong>free</strong> in the internet via an API.
While working with stocks only the available sources may be good enough, inclusion of ETF’s into portfolio makes things more difficult.
Consequently, there is may be a need to search for alternative tools.</p>
<p>The first and most plainly obvious solution is to run the <code>tidyquant</code> wit custom DNS resolver disabled.
This means as well that you’ll have to limit your choices to the most popular listings, which appear on <em>Yahoo</em>.
For personal side-project this may be the optimal choice.</p>
<p>The second option is to go directly <em>scrapping</em> with native <em>R</em> toolset over the web for data.
Among the drawbacks of this solution we have an incredible time-waste on creation of your own <em>wheel</em> to hunt for the data.
Moreover, there is constant risk that your <em>wheel</em> will break because of the third party decisions (ex: changes in the source website data distribution policy, updates, etc).
This solution is equally inefficient because most websites provide a limited amount of historical data (ex: 3 or 5 years), which potentially limits the amount of learning to be done over it.</p>
<p>Another alternative includes <em>paying for access</em> to private databases,
Unfortunately, the prices are extremely discouraging when you aim at small personal project.
The fees vary between 30-100$$ for entry level options and, as always, the upper limit is non-existent.
Obviously, this is absolutely unreasonable when you want to run some tests with just a 100€.</p>
<p>Finally, there exist some alternative solutions (premade scrappers and other API interfaces) for other languages
(ex: <code>python</code>, which is extremely popular because of its more permissive licence).
This may be an interesting path to follow, which we’ll probably do in near future.</p>
</div>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/programming" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Programming</a>
   </li>
  
   <li class="list">
     <a href="/tags/r" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">R</a>
   </li>
  
   <li class="list">
     <a href="/tags/finance" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Finance</a>
   </li>
  
   <li class="list">
     <a href="/tags/time-series" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Time Series</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/2022-02-04-bibliometrix/">Bibliometrix</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2021-12-27-rstudio-or-vs-code/">RStudio or VS Code</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2022-02-03-pass/">`Pass` for password management</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2022-02-01-self-hosting/">Self-hosting</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2022-01-29-onlykey-for-linux/">OnlyKey for Linux login</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2021-08-31-website-p3/">Building a website (part 3)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2021-08-29-website-p2/">Building a website (part 2)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/2021-08-28-website/">Building a website (part 1)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nikitagusarov.github.io/" >
    &copy;  Nikita Gusarov 2023 
  </a>
    <div>







<a href="https://linkedin.com/in/nikitagusarov" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/nikitagusarov" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://gitlab.com/nikitagusarov" target="_blank" class="link-transition gitlab link dib z-999 pt3 pt0-l mr1" title="Gitlab link" rel="noopener" aria-label="follow on Gitlab——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path d="M29.782 199.732L256 493.714 8.074 309.699c-6.856-5.142-9.712-13.996-7.141-21.993l28.849-87.974zm75.405-174.806c-3.142-8.854-15.709-8.854-18.851 0L29.782 199.732h131.961L105.187 24.926zm56.556 174.806L256 493.714l94.257-293.982H161.743zm349.324 87.974l-28.849-87.974L256 493.714l247.926-184.015c6.855-5.142 9.711-13.996 7.141-21.993zm-85.404-262.78c-3.142-8.854-15.709-8.854-18.851 0l-56.555 174.806h131.961L425.663 24.926z"></path></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>






</div>
  </div>
</footer>

  </body>
</html>
